<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Vodafone Paredes de Coura</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html { font-size: 16px; }
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background-image: url('https://i.postimg.cc/RFRYVBNk/vpc.png');
      background-repeat: no-repeat;
      background-attachment: fixed;
      background-size: cover;
      background-color: #ED1C24;
      color: white;
      height: 100vh;
      overflow: hidden;
      padding: 1.25rem;
    }
    .content {
      height: 100vh;
      overflow-y: auto;
      padding: 1.25rem;
      box-sizing: border-box;
    }
    h1 { text-align: center; font-size: 3rem; margin-bottom: 2.5rem; }

    .day-container { margin-bottom: 2.5rem; padding: 5rem; box-sizing: border-box; }
    .day-container > h2 {
      text-align: center;
      margin-bottom: 1.25rem;
      font-weight: 800;
      font-size: 2rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.4);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 0.625rem;
      background-color: rgba(0, 0, 0, 0.15);
      box-shadow: 0 0.25rem 0.625rem rgba(0, 0, 0, 0.3);
      border-radius: 0.75rem;
      overflow: hidden;
      font-size: 1.5rem;
    }
    th, td {
      padding: 1.25rem 0.5rem;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    th { background-color: rgba(0,0,0,0.3); font-weight: bold; }
    td.selectable:hover { cursor: pointer; background-color: rgba(255,255,255,0.1); }
    td.selected { background-color: rgba(255,255,255,0.2); font-weight: bold; }

    .selected-artists {
      font-size: 1.2rem !important;
      margin: 3.75rem;
      background-color: rgba(0, 0, 0, 0.25);
      padding: 4rem 5rem;
      border-radius: 0.75rem;
      margin-bottom: 20rem;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      color: white;
      font-family: 'Arial', sans-serif;
      position: relative;
      height: auto;
      overflow: visible;
      width: auto;
      box-sizing: border-box;
    }

    .selected-artists h2 { font-size: 1.6rem !important; font-weight: 700; margin-bottom: 1rem; }
    .selected-artists h3 { font-size: 1.4rem !important; font-weight: 600; margin-top: 1.875rem; }

    .selected-artists ul {
      list-style: none;
      padding-left: 0;
      margin-top: 0.5rem;
      max-height: 300px;
      overflow-y: auto;
    }

    .selected-artists li {
      font-size: 1.1rem !important;
      font-weight: 600;
      margin: 0.5rem 0;
      padding: 0.5rem 1rem;
      background-color: rgba(255,255,255,0.15);
      border-radius: 0.5rem;
      line-height: 2;
      color: white;
      cursor: default;
      transition: background-color 0.3s ease;
      white-space: nowrap;
      overflow: visible;
      text-overflow: clip;
    }

    #download-image {
      position: absolute;
      top: 15px;
      right: 15px;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      font-weight: 700;
      background-color: #ED1C24;
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(237,28,36,0.8);
      transition: background-color 0.3s ease;
      z-index: 10;
    }
    #download-image:hover { background-color: #c7151a; }
  </style>
</head>
<body>
  <div class="content">
    <h1>Vodafone Paredes de Coura</h1>
    <div id="schedule"></div>

    <div class="selected-artists" id="selected-artists">
      <h2>My Schedule</h2>
      <button id="download-image">Save Image</button>
      <div id="selected-artists-list"></div>
    </div>
  </div>

  <!-- html2canvas cdn -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    const data = {
      "13 de Agosto": [
        ["16:30", "BacanaPlay", "Being Dead"],
        ["17:15", "Vodafone", "Samuel Úria"],
        ["18:00", "BacanaPlay", "Unsafe Space Garden"],
        ["18:40", "Vodafone", "Nilüfer Yanya"],
        ["19:40", "BacanaPlay", "Cass McCombs"],
        ["20:40", "Vodafone", "MJ Lenderman & The Wind"],
        ["21:40", "BacanaPlay", "Don West"],
        ["22:25", "Vodafone", "Zaho de Sagazan"],
        ["23:35", "BacanaPlay", "Capicua"],
        ["00:20", "Vodafone", "Vampire Weekend"],
        ["01:50", "BacanaPlay", "Joey Valence & Brae"],
        ["02:45", "BacanaPlay", "Badsista"]
      ],
      "14 de Agosto": [
        ["16:30", "BacanaPlay", "Bed Legs"],
        ["17:10", "Vodafone", "Linda Martini"],
        ["18:00", "BacanaPlay", "Glockenwise"],
        ["18:40", "Vodafone", "Terno Rei"],
        ["19:40", "BacanaPlay", "La Lom"],
        ["20:40", "Vodafone", "Perfume Genius"],
        ["21:40", "BacanaPlay", "Fat Dog"],
        ["22:40", "Vodafone", "Lola Young"],
        ["23:40", "BacanaPlay", "Soft Play"],
        ["00:35", "Vodafone", "Portugal. The Man"],
        ["01:50", "BacanaPlay", "Maruja"],
        ["03:00", "BacanaPlay", "The Hellp"]
      ],
      "15 de Agosto": [
        ["16:30", "BacanaPlay", "Memória de Peixe"],
        ["17:10", "Vodafone", "Dino D'Santiago"],
        ["18:00", "BacanaPlay", "Cassandra Jenkins"],
        ["18:50", "Vodafone", "Geordie Greep"],
        ["19:50", "BacanaPlay", "Bar Italia"],
        ["20:45", "Vodafone", "Black Country, New Road"],
        ["21:50", "BacanaPlay", "Lambrini Girls"],
        ["22:35", "Vodafone", "King Krule"],
        ["23:50", "BacanaPlay", "La Jungle"],
        ["00:35", "Vodafone", "MK.Gee"],
        ["01:35", "BacanaPlay", "Ela Minus"],
        ["02:45", "BacanaPlay", "Jersey"]
      ],
      "16 de Agosto": [
        ["16:30", "BacanaPlay", "Cassete Pirata"],
        ["17:10", "Vodafone", "Ana Frango Elétrico"],
        ["18:10", "BacanaPlay", "Chastity Belt"],
        ["18:55", "Vodafone", "DIIV"],
        ["19:55", "BacanaPlay", "Hinds"],
        ["20:40", "Vodafone", "Sharon Van Etten & The Attachment"],
        ["21:45", "BacanaPlay", "Warmduscher"],
        ["22:45", "Vodafone", "Air"],
        ["00:00", "BacanaPlay", "Lander & Adriaan"],
        ["01:00", "Vodafone", "Franz Ferdinand"],
        ["02:20", "BacanaPlay", "Gurriers"],
        ["03:25", "BacanaPlay", "Chinobi Live"]
      ]
    };

    const selectedArtists = {};
    const container = document.getElementById("schedule");
    const selectedContainer = document.getElementById("selected-artists-list");

    const saved = localStorage.getItem('selectedArtists');
    if (saved) {
      const parsed = JSON.parse(saved);
      Object.keys(parsed).forEach(day => selectedArtists[day] = new Set(parsed[day]));
    }

    Object.keys(data).forEach(day => {
      if (!selectedArtists[day]) selectedArtists[day] = new Set();

      const dayDiv = document.createElement("div");
      dayDiv.className = "day-container";

      const title = document.createElement("h2");
      title.textContent = day;
      dayDiv.appendChild(title);

      const table = document.createElement("table");
      const thead = document.createElement("thead");
      thead.innerHTML = `<tr><th>Hora</th><th>Palco Vodafone</th><th>Palco BacanaPlay</th></tr>`;
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      const horarios = {};

      data[day].forEach(([hora, palco, artista]) => {
        if (!horarios[hora]) horarios[hora] = {};
        horarios[hora][palco] = artista;
      });

      Object.keys(horarios).forEach(hora => {
        const tr = document.createElement("tr");
        const tdHora = document.createElement("td");
        tdHora.textContent = hora;
        tr.appendChild(tdHora);

        ["Vodafone","BacanaPlay"].forEach(palco => {
          const td = document.createElement("td");
          const artista = horarios[hora][palco];
          if (artista) {
            td.textContent = artista;
            td.classList.add("selectable");
            const entry = `${hora} - ${artista}`;
            if (selectedArtists[day].has(entry)) td.classList.add("selected");
            td.addEventListener("click", () => {
              if (selectedArtists[day].has(entry)) {
                selectedArtists[day].delete(entry);
                td.classList.remove("selected");
              } else {
                selectedArtists[day].add(entry);
                td.classList.add("selected");
              }
              updateSelectedArtists();
              saveSelectedArtists();
            });
          }
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
      dayDiv.appendChild(table);
      container.appendChild(dayDiv);
    });

    function timeToSortableNumber(timeStr) {
      const [hh, mm] = timeStr.split(':').map(Number);
      const hourAdjusted = (hh < 6) ? hh + 24 : hh;
      return hourAdjusted * 60 + mm;
    }

    function updateSelectedArtists() {
      selectedContainer.innerHTML = "";
      Object.keys(selectedArtists).forEach(day => {
        if (selectedArtists[day].size === 0) return;

        const dayTitle = document.createElement("h3");
        dayTitle.textContent = day;
        selectedContainer.appendChild(dayTitle);

        const ul = document.createElement("ul");

        Array.from(selectedArtists[day])
          .sort((a,b) => {
            const getTime = str => str.split(' - ')[0];
            return timeToSortableNumber(getTime(a)) - timeToSortableNumber(getTime(b));
          })
          .forEach(artist => {
            const li = document.createElement("li");
            li.textContent = artist;
            ul.appendChild(li);
          });

        selectedContainer.appendChild(ul);
      });
    }

    function saveSelectedArtists() {
      localStorage.setItem('selectedArtists', JSON.stringify(
        Object.fromEntries(
          Object.entries(selectedArtists).map(([day, set]) => [day, Array.from(set)])
        )
      ));
    }

    document.getElementById('download-image').addEventListener('click', async () => {
      const selectedArtistsDiv = document.querySelector('.selected-artists');
      const button = document.getElementById('download-image');
      button.style.display = 'none';
      const parent = selectedArtistsDiv.parentNode;
      const nextSibling = selectedArtistsDiv.nextSibling;
      const originalInline = {
        width: selectedArtistsDiv.style.width || '',
        backgroundImage: selectedArtistsDiv.style.backgroundImage || '',
        backgroundRepeat: selectedArtistsDiv.style.backgroundRepeat || '',
        backgroundSize: selectedArtistsDiv.style.backgroundSize || '',
        backgroundPosition: selectedArtistsDiv.style.backgroundPosition || '',
        backgroundColor: selectedArtistsDiv.style.backgroundColor || '',
        margin: selectedArtistsDiv.style.margin || '',
        padding: selectedArtistsDiv.style.padding || ''
      };

      const wrapper = document.createElement('div');
      wrapper.setAttribute('aria-hidden','true');

      wrapper.style.position = 'fixed';
      wrapper.style.left = '50%';
      wrapper.style.top = '50%';
      wrapper.style.transform = 'translate(-50%, -50%)';
      wrapper.style.zIndex = '9999';
      wrapper.style.display = 'inline-block';
      wrapper.style.padding = '24px';
      wrapper.style.borderRadius = '12px';
      wrapper.style.boxShadow = '0 30px 80px rgba(0,0,0,0.6)';
      wrapper.style.background = "linear-gradient(rgba(0,0,0,0.15), rgba(0,0,0,0.25)), url('https://i.postimg.cc/qvHXw6HK/Captura-de-ecr-2025-08-08-203125.png')";
      wrapper.style.backgroundSize = 'cover';
      wrapper.style.backgroundPosition = 'center';
      wrapper.style.overflow = 'visible';

      const viewportW = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
      const contentWidth = selectedArtistsDiv.scrollWidth || selectedArtistsDiv.offsetWidth || 700;
      const minNeeded = contentWidth + 80;
      const desiredWidth = Math.min(Math.max(minNeeded, 700), Math.max(viewportW - 40, 400));
      wrapper.style.width = desiredWidth + 'px';

      selectedArtistsDiv.style.backgroundColor = 'rgba(0,0,0,0.35)';
      selectedArtistsDiv.style.margin = '0';
      parent.insertBefore(wrapper, selectedArtistsDiv);
      wrapper.appendChild(selectedArtistsDiv);

      try {
        const canvas = await html2canvas(wrapper, {
          scale: 2,
          useCORS: true,
          backgroundColor: null,
          width: wrapper.offsetWidth,
        });

        const link = document.createElement('a');
        link.download = 'artistas-selecionados.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      } catch (err) {
        console.error('Erro ao gerar imagem:', err);
        alert('Ocorreu um erro ao gerar a imagem. Verifica a consola.');
      } finally {
        if (nextSibling) parent.insertBefore(selectedArtistsDiv, nextSibling);
        else parent.appendChild(selectedArtistsDiv);
        wrapper.remove();

        selectedArtistsDiv.style.width = originalInline.width;
        selectedArtistsDiv.style.backgroundImage = originalInline.backgroundImage;
        selectedArtistsDiv.style.backgroundRepeat = originalInline.backgroundRepeat;
        selectedArtistsDiv.style.backgroundSize = originalInline.backgroundSize;
        selectedArtistsDiv.style.backgroundPosition = originalInline.backgroundPosition;
        selectedArtistsDiv.style.backgroundColor = originalInline.backgroundColor;
        selectedArtistsDiv.style.margin = originalInline.margin;
        selectedArtistsDiv.style.padding = originalInline.padding;

        button.style.display = 'block';
      }
    });

    // render initial selected list
    updateSelectedArtists();
  </script>
</body>
</html>
